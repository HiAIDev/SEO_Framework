'use strict';window.tsfPTGB=function(a){var b='undefined'!=typeof tsfPTL10n&&tsfPTL10n;const{addFilter:c}=wp.hooks,{createElement:d,Fragment:e}=wp.element,{SelectControl:f}=wp.components,{addQueryArgs:g}=wp.url,h=wp.apiFetch,{invoke:j}=lodash,k={per_page:-1,orderby:'id',order:'asc',_fields:'id,name'},l=function(){if(tsf.hasInput&&Object.keys(b.taxonomies).length){let m=b.taxonomies,n=wp.template('tsf-primary-term-selector'),o={};const p=function(E,F){return F in m[E].i18n&&m[E].i18n[F]||''},q=function(E){return document.getElementById(`autodescription[_primary_term_${E}]`)},r=function(E){return+q(E).value},s=function(E,F){return q(E).value=+F},t=function(E){let F=document.getElementById('tsf-gutenberg-data-holder');if(!F)return o[E]=!1;let G=n({taxonomy:m[E]});return o[E]=!!a(F).html(G)},u=function(E){return o[E]},v=function(E,F){0>F.indexOf(r(E))&&(0 in F?s(E,F[0]):s(E,0))},w=function(E,F){return s(E,F)};(function(){for(let E in m)t(E)})();var x={};class y{constructor(E){this.slug=E,this.reset()}registeredData(){return!!Object.keys(this.data).length}reset(){this.data={}}read(){return this.data}get(E){return E in this.data&&this.data[E]||null}set(E,F){return this.data[E]=F}}const z=function(E){return x[E]=new y(E)},A=function(E){return x[E]||z(E)};class B extends React.Component{constructor(E){super(E),this.state={loading:!0}}componentDidMount(){this.updateData(),this.dsAccess().registeredData()&&this.setState({loading:!1})}componentWillUnmount(){j(this.fetchRequest,['abort']),j(this.addRequest,['abort'])}componentDidUpdate(E){if(this.updateData(),2<this.props.terms.length&&!this.dsAccess().get('availableTerms'))this.fetchTerms();else if(this.props.terms!==E.terms){let G=this.props.terms.filter(function(H){return-1===E.terms.indexOf(H)});G.length&&!this.isTermAvailable(G[0])&&this.fetchTerms()}}updateData(){this.dsAccess().registeredData()||(this.dsAccess().set('availableTerms',[]),this.fetchTerms()),this.dsAccess().set('selectedTerms',this.props.terms)}updateTerms(){this.updateData()}dsAccess(){return A(this.props.slug)}isTermAvailable(E){let F=this.dsAccess().get('availableTerms');return F.some(function(G){return G.id===E})}fetchTerms(){var F=this;const{taxonomy:E}=this.props;E&&(this.setState({selectedTerms:this.props.terms,loading:!0}),this.lockRef(),this.fetchRequest=h({path:g(`/wp/v2/${E.rest_base}`,k)}),this.fetchRequest.then(function(G){F.fetchRequest=null,F.setState({loading:!1}),F.dsAccess().set('availableTerms',G),F.updateRef()},function(G){'abort'===G.statusText||(F.fetchRequest=null,F.setState({loading:!1}),F.updateRef())}))}lockRef(){this.tsRef&&this.tsRef.current&&(this.tsRef.current.props.disabled=!0,this.tsRef.current.forceUpdate())}updateRef(){this.tsRef&&this.tsRef.current&&(this.tsRef.current.props.options=this.getSelectOptions(),this.tsRef.current.props.disabled=!1,this.tsRef.current.forceUpdate())}}class C extends B{constructor(E){super(E),this.onChange=this.onChange.bind(this),this.tsRef=React.createRef()}getTermName(E){let F=this.dsAccess().get('availableTerms');if(tsf.browseUnhappy){for(let H in F)if(F[H].id===E)return F[H]&&F[H].name||'';return''}let G=F.find(function(H){return H.id===E});return G&&G.name||''}getSelectOptions(){var E=this;return this.dsAccess().get('selectedTerms').sort().map(function(F){return{value:F,label:E.getTermName(F)}})}onChange(E){this.tsRef.current.props.value=w(this.props.slug,E),this.tsRef.current.forceUpdate()}render(){return this.updateData(),d(f,{label:p(this.props.slug,'selectPrimary'),value:r(this.props.slug),id:'tsf-pt-gb-selector',onChange:this.onChange,options:this.state.loading?'':this.getSelectOptions(),disabled:this.state.loading,ref:this.tsRef})}}c('editor.PostTaxonomyType','tsf/pt',function(E){return class extends B{initSelectors(){const{slug:F,terms:G}=this.props;return u(F)&&(v(F,G),1<G.length)?d(e,{},d(C,this.props)):null}render(){return!this.props.slug in m?void 0:d(e,{},d(E,this.props),this.initSelectors())}}},20)}};return a.extend({load:function(){a(document.body).on('tsf-onload',l)}},{})}(jQuery),jQuery(window.tsfPTGB.load);
